<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head th:replace="fragments/head :: head('Tasks')"></head>

<body>

    <!-- Header -->
    <div th:replace="fragments/header :: header"></div>

    <p class="text-center font-bold text-sm mb-4 bg-green-400" th:if="${success != null}" th:text="${success}"></p>
    <p class="text-center font-bold text-sm mb-4 bg-yellow-400" th:if="${warning != null}" th:text="${warning}"></p>
    <p class="text-center font-bold text-sm mb-4 bg-red-400" th:if="${error != null}" th:text="${error}"></p>

    <!-- Content -->
    <div class="container mx-auto p-4 flex flex-col gap-4 justify-center items-center overflow-y-scroll">
        <!-- Tasks-->
        <h1 th:if="${userTasks == null or userTasks.size() == 0}" class="mt-5 text-2xl font-bold text-blue-600">No tasks
            found</h1>

        <ul th:if="${userTasks != null and userTasks.size() > 0}" class="w-full">
            <h1 class="text-2xl font-bold text-blue-600 border-b border-blue-600">Pending Tasks</h1>
            <li th:each="task : ${userTasks}" th:if="${task.status == TaskStatus.PENDING}"
                class="flex flex-row gap-4 items-center bg-white rounded p-3 shadow">

                <form th:action="@{/tasks/{id}/status(id=${task.id})}" method="post" th:object="${task}">
                    <input type="hidden" name="status"
                        th:value="${task.status == TaskStatus.COMPLETED ? 'PENDING' : 'COMPLETED'}" />

                    <input type="checkbox" th:checked="${task.status == TaskStatus.COMPLETED}"
                        onchange="this.form.submit()" />
                </form>

                <div>
                    <h2 class="text-lg font-bold" th:text="${'Title: ' + task.title}"></h2>
                    <p class="text-gray-600" th:text="${'Description: ' + task.description}"></p>
                    <p class="text-gray-600" th:text="${'Priority: ' + task.priority}"></p>
                </div>
            </li>
        </ul>

        <!-- Completed Tasks-->
        <ul th:if="${userTasks != null and userTasks.size() > 0}" class="w-full bg-white rounded p-2">
            <h1 class="text-2xl font-bold text-blue-600 border-b border-blue-600">
                Completed Tasks</h1>
            <li th:each="task : ${userTasks}" th:if="${task.status == TaskStatus.COMPLETED}"
                class="flex flex-row gap-4 items-center bg-white rounded p-3 shadow">

                <form th:action="@{/tasks/{id}/status(id=${task.id})}" method="post" th:object="${task}">
                    <input type="hidden" name="status"
                        th:value="${task.status == TaskStatus.COMPLETED ? 'PENDING' : 'COMPLETED'}" />

                    <input type="checkbox" th:checked="${task.status == TaskStatus.COMPLETED}"
                        onchange="this.form.submit()" />
                </form>

                <div>
                    <h2 class="text-lg font-bold" th:text="${'Title: ' + task.title}"></h2>
                    <p class="text-gray-600" th:text="${'Description: ' + task.description}"></p>
                    <p class="text-gray-600" th:text="${'Priority: ' + task.priority}"></p>
                </div>

                <div>
                    <p>Completed at:
                        <span th:text="${#temporals.format(task.completedAt, 'yyyy/MM/dd HH:mm')}"></span>
                    </p>
                </div>
            </li>
        </ul>

    </div>

    <!-- Floating Button and Modal-->
    <div x-data="{ openModal: false }" class="fixed bottom-4 right-4 sm:hidden">
        <button @click="openModal = true"
            class="bg-blue-500 hover:bg-blue-600 text-white rounded-full py-3 px-4 shadow-lg">
            <img th:src="@{/img/plus.svg}" alt="+" class="w-8 h-8">
        </button>

        <div x-show="openModal" x-transition
            class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">

            <div class="bg-white p-6 rounded-lg shadow-lg w-96" @click.away="openModal = false">

                <h2 class="text-xl font-bold mb-4">Add Task</h2>

                <!-- Forms -->
                <form th:action="@{/tasks}" method="post">
                    <div class="mb-3">
                        <label class="block text-gray-700 mb-1">Title</label>
                        <input type="text" name="title" class="w-full border border-gray-300 rounded p-2" required>
                    </div>

                    <div class="mb-3">
                        <label class="block text-gray-700 mb-1">Description</label>
                        <textarea name="description" class="w-full border border-gray-300 rounded p-2"></textarea>
                    </div>

                    <input type="hidden" name="status" th:value="PENDING">

                    <div class="mb-3">
                        <label class="block text-gray-700 mb-1">Priority</label>
                        <select name="priority" class="w-full border border-gray-300 rounded p-2 outline-blue-500">
                            <option th:each="priority : ${priorities}" th:value="${priority}" th:text="${priority}">
                                Priority</option>
                        </select>
                    </div>

                    <div class="flex justify-end gap-3 mt-4">
                        <button type="button" @click="openModal = false"
                            class="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400">
                            Cancelar
                        </button>

                        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-500">
                            Salvar
                        </button>
                    </div>
                </form>

            </div>
        </div>

    </div>
</body>

</html>